Motor control PCB

General notes:


Suggestions for general layout (feel free to do things differently if you think something works better):  

4 layers: power plane divided into a 3.3V sections, 1 5V sections, and a V_supply(output of battery) sections, a unified ground plane, and two signal planes in the order of S-GnD-Pwr-S from top to bottom. 
Try to ensure that digital signals do not cross over the different power planes (a way to make this easier is to fill in all the areas of the power plane you don't need with copper that is connected to the GND plane).  
On the board signal ground and power ground should be kept seperate only connecting at a single point. Signal ground should be subdivided into analog and digital grounds and connected only at one point
Without violating any of these other criteria traces between components should be as short as possible.

There is no need to avoid right angles because at the frequencies we are working at the difference in EMI between 45 and 90 degree angles is unmeasureable.
In fact that's true for the frequencies any PCB is working at, even in multiple GHZ range.

Pinouts and Connections Between Components (there are alternative pins for all functionality on the DSC that we are using, listed on the datasheet, 
so feel free to select those if it makes routing easier, but let me know if you do so and refer.) 

Names in paranthesis are the component labels which can be found on the electrical BOM. If you see a part reference in a connection and want to know what it is just search in this document for label
in parenthisis e.g., "(R4)" and that'll get you to where it is listed. If a number is skipped that means I deleted something but didn't want to go back and change all the labels.

part number is the manufacturer part number which is also the name of component model and footprint you select


The circuit description is broken up into sections by function.  If there are multiple of the same component, there will be a line listing with the component is and then
	a line(s) listing what their pinouts and connections are.


 Digital signal controller 
	1x Digital signal controller 100 LPFQ part name STM32F765VIT6 (DSC)
	pinout:
		pin 6: connected to 3.3V 
		pin 8: connected to pin 1 of R1  
		pin 9: connected to pin 1 of R2  
		pin 10: connected to digital GND
		pin 11: connected to 3.3V 
		pin 14: connected to pin 1 of SWD
		pin 15: connected to pin 2 of R12 
		pin 16: connected to pin 2 of R13 
		pin 17: connected to pin 2 of R14 
		pin 18: connected to pin 2 of R29
		pin 19: connected to analog GND
		pin 20: connected to 3.3V 
		pin 21: connected to pin 20 of DSC 
		pin 23: connected to pin 2 of R26 
		pin 24: connected to pin 2 of R27 
		pin 26: connnected to digital GND
		pin 27: connected to 3.3V
		pin 28: connected to pin 2 of R28
		pin 29: connected to pin 2 of RTS1
		pin 38: connected to pin 22 of DRV1
		pin 39: connected to pin 21 of DRV1
		pin 40: connected to pin 20 of DRV1
		pin 41: connected to pin 19 of DRV1
		pin 42: connected to pin 18 of DRV1
		pin 43: connected to pin 17 of DRV1
		pin 44: connected to pin 16 of DRV1
		pin 45: connected to pin 6 of DRV1
		pin 46: connected to pin 1 of RECV
		pin 47: connected to pin 2 of RECV
		pin 48: connected to pin 1 of C38
		pin 49: connected to digital GND
		pin 50: connected to 3.3V
		pin 61: connected to pin 3 of BUSCNT 
		pin 70: connected to pin 4 of CAN_tr
		pin 71: connected to pin 1 of CAN_tr
		pin 72: connected to pin 4 of SWD
		pin 73: connected to pin 1 of C38
		pin 74: connected to digital GND
		pin 75: connected to 3.3V
		pin 76: connected to pin 2 of SWD
		pin 94: connected to digital GND
		pin 99: connected to digital GND
		pin 100: connected to 3.3V
		
		
	2x 1 uf ceramic capacitors part number GRM155C81C105ME11J
		1x connected between pin 19 and pin 20 as close as possible (C35)
		1x connected between pin 95 and pin 94 as close as possible (C36)
	2x 2.2 uf ceramic capacitors part number C3216X7R1H225K160AE 
		1x connected between pin 48 and pin 49 as close as possible (C37)
		1x connected between pin 73 and pin 74 as close as possible (C38)
	1x 4.7 uf ceramic capacitors part number CGA6M3X7S2A475K200AB
		1x connected between pin 10 and pin 11 as close as possible (C39)
	4x 2.2 kohm resistors part number RK73H1JTTD2201F
		1x connected between DSC pin 15 and analog GND (R22)
		1x connected between DSC pin 16 and analog GND (R23)
		1x connected between DSC pin 17 and analog GND (R24)
		1x connected between DSC pin 18 and analog GND (R25)
	7x .1 uf capacitors part number AS0805KKX7R0BB104
		1x connected between DSC pin 6 and digital GND (C40)
		1x connected between DSC pin 10 and DSC pin 11 (C41)
		1x connected between DSC pin 19 and DSC pin 20 (C42)
		1x connected between DSC pin 26 and DSC pin 27  (C43)
		1x connected between DSC pin 49 and DSC pin 50 (C44)
		1x connected between DSC pin 74 and DSC pin 75 (C45)
		1x connected between DSC pin 99 and DSC pin 100 (C46)

		
	4x 39 kohm resistors part number ERJ-3EKF3902V
		1x connected between DSC pin 15 and Q1 pin 3 (R26)
		1x connected between DSC pin 16 and Q3 pin 3 (R27)
		1x connected between DSC pin 17 and Q5 pin 3 (R28)
		1x connected between DSC pin 18 and Battery Supply (R29)

 LEDs
	1x green LED part number LTST-C191KGKT (D2)
	pinout:
		pin 1: Anode, connected to pin 2 of R1
		pin 2: Cathode, connected to digital GND
		
	1x red LED part number LTST-C191KRKT (D3)
	pinout:
		pin 1: Anode, connected to pin 2 of R2
		pin 2: Cathode, connected to digital GND
	2x 100 ohm resistors part number part number RK73H1JTTD1000F
		1x connected betweem pin 8 of DSC and pin 1 of D2 (R1)
		1x connected between pin 9 of DSC and pin 1 of D3 (R2)
		

 Board to wire connectors:
	 Place all connectors on the edges of the board, preferably away from the Power MOSFETs

	1x 5 pin connector for debugging/ programming part number SM05B-PASS-TBT(LF)(SN) (SWD)
	pinout:

		pin 1: VCC connect to 3.3V plane 
		pin 2: SWCLK connect to pin 76 on DSC
		pin 3: GND connect to dig ground
		pin 4: SWDIO connected to pin 72 on DSC
		pin 5: NRST connected to pin 14 on DSC
	

	1x  5 pin connector  for connecting CAN and wakeup wires between each PCB part number SM05B-PASS-TBT(LF)(SN) (BUSCNT)
	pinout:
		pin 1 CANH, connected to pin 7 of CAN_TR
		pin 2 GND, connected to dig GND
		pin 3 V-wakeup connected to pin 61 of DSC 
		pin 4 CANL, connected to pin 2 of CAN_TR
		pin 5 connect to 5-volt power section #2

	 1 4 pin header connector to potential wireless reciever part number SM04B-PASS-TBT(LF)(SN) (RECV)
	 pinout: 
		pin 1: connected to DSC 46
		pin 2: connected to DSC 47
		pin 4: connected to digital GND		
		pin 3: connected to 5 volt section #1
 Wire solder Pads:

	

	5x 10 AWG large pads for soldering low gauge wire 
		1x connected to pin 1 of R9 (P1)
		1x connected to pin 1 of R10 (P2)
		1x connected to pin 1 of R11 (P3)
		1x connected to Battery Supply (P4)
		1x connected to pwr ground plane (P5)

		
 CANBUS:
	1x can transceiver part number SN65HVD232DR (CAN_TR)
	pinout:
		pin 1: Transmit data input pin connected to pin 71 on DSC
		pin 2: Connected to GND
		pin 3: connected to 3.3V
		pin 4: Recieved data output pin, connected to pin 70 on DSC
		pin 5: not connected
		pin 6: CANL, connected to pin 4 of BUSCNT
		pin 7: CANH, connected to pin 1 of BUSCNT
		pin 8: not connected
		
	1x 120 ohm termination resistor part number ERA-3AEB121V connecting pin 6 and 7 of CAN_TR (RTERM)
	1x .1 uf capacitor part number AS0805KKX7R0BB104 connected between pin 2 and pin 3 of CAN_TR (C1) 

	


 Voltage regulation:
	1x 3.3V voltage regulator part number TC2117-3.3VDBTR (Reg)
	pintout:
		pin 1: connected to dig GND 
		pin 2: Vin, connected to 3.3V and pin 1 of C2
		pin 3: Vin, connected to 5V and pin 1 of C2
	2x 1 uf ceramic capacitor part number GRM155C81C105ME11J 
		1x  connected between pin 2 of Reg1 and the dig GND plane (C2)
		1x  connected between pin 3 of Reg1 and the dig GND plane (C3) 


 Power fets:
	6x NMOS power fets part number IRFS7730TRLPBF.
	fet structure: On one end of the board, all on the top layer
		All fets are To-252-3 packages.  Pinouts are with respect to the chip facing at you, pin 1 is the leg on the left, pin 2 is the long bar on the opposite site of the chip 
		and pin 3 is the leg on the right. 
	(Q1) pinout:
		pin 1: gate, connected to pin 2 of R6 
		pin 2: drain connected to Battery Supply
		pin 3: source connected to pin 1 of R23 , pin 46 of DVR1, and pin 1 of R30
	(Q2) pinout:
		pin 1: gate, connected to pin 2 of R7
		pin 2: drain connected to pin 3 of Q1
		pin 3: source connected to dig GND 
	(Q3) pinout:
		pin 1: gate, connected to pin 2 of R8 
		pin 2: drain connected to Battery Supply
		pin 3: source connected to pin 1 of R25,  pin 41 of DVR1, and pin 1 of R31
	(Q4) pinout:
		pin 1: gate, connected to pin 2 of R9
		pin 2: drain connected to pin 3 of Q3
		pin 3: source connected to dig GND
	(Q5) pinout:
		pin 1: gate, connected to pin 2 of R10
		pin 2: drain connected to Battery Supply
		pin 3: source connected to pin 1 of R27, pin 36 of DVR1, and pin 1 of R32
	(Q6) pinout:
		pin 1: gate, connected to pin 2 of R11
		pin 2: drain connected to pin 3 of Q5
		pin 3: source connected to dig GND
	
	
	6x 4.7 uf capacitors, part number CGA6M3X7S2A475K200AB
		2x connected in parallel between pin 2 of Q1 and pin 3 of Q2 (C4),(C5)
		2x connected in parallel between pin 2 of Q3 and pin 3 of Q4 (C7),(C6)
		2x connected in parallel between pin 2 of Q5 and pin 3 of Q6 (C8),(C9)
		
	
	6x 4.7 ohm resistors, part number RK73H1JTTD4R70F
		1x connected between pin 1 of Q1 and pin 47 of DVR (R3)
		1x connected between pin 1 of Q2 and pin 45 of DVR (R4)
		1x connected between pin 1 of Q3 and pin 42 of DVR (R5)
		1x connected between pin 1 of Q4 and pin 40 of DVR (R6)
		1x connected between pin 1 of Q5 and pin 37 of DVR (R7)
		1x connected between pin 1 of Q6 and pin 35 of DVR (R8)


 Current sensing circuitry
	3x 1 milliohm shunt resistors part number WSLP27261L000FEA 
	(R9) pinout:
		pin 1: connected to P1
		pin 2: connected to pin	3 of Q1
		pin 3: pin 1 of CS1
		pin 4: connected to pin 8 of CS1
	(R10) pinout:
		pin 1: connected to P2
		pin 2: connected to pin	3 of Q3
		pin 3: pin 1 of CS2
		pin 4: connected to pin 8 of CS2
	(R11) pinout:
		pin 1: connected to P3
		pin 2: connected to pin	3 of Q5
		pin 3: pin 1 of CS3
		pin 4: connected to pin 8 of CS3

	
	3x current sense amplifiers part number AD8418ABRMZ 
	(CS1) pinout:
		pin 1: connected to pin 3 of R9
		pin 2: connected to GND
		pin 3: connected to pin 2 of CS1 and pin 2 of C13
		pin 4: Not connected
		pin 5: connected to pin 1 of R12
		pin 6: connected to pin 7 of CS1
		pin 7: connected to 5V+ and pin 1 of C13
		pin 8: connected to pin 4 of R9
	(CS2) pinout:
		pin 1: connected to pin 3 of R10
		pin 2: connected to GND
		pin 3: connected to pin 2 of CS2 and pin 2 of C14
		pin 4: Not connected
		pin 5: connected to pin 1 of R13
		pin 6: connected to pin 7 of CS2
		pin 7: connected to 5V+ and pin 1 of C14
		pin 8: connected to pin 4 of R10
	(CS3) pinout:
		pin 1: connected to pin 3 of R11
		pin 2: connected to GND
		pin 3: connected to pin 2 of CS3 and pin 2 of C15
		pin 4: Not connected
		pin 5: connected to pin 1 of R14
		pin 6: connected to pin 7 of CS3
		pin 7: connected to 5V+ and pin 1 of C15
		pin 8: connected to pin 4 of R11
	
	3x 100 ohm resistors part number RK73H1JTTD1000F
		1x connected between pin 15 of DSC and pin 5 of CS1 (R12)
 		1x connected between pin 16 of DSC and pin 5 of CS2 (R13)
		1x connected between pin 17 of DSC and pin 5 of CS3 (R14)
		
	3x 4.7nf capacitors part number GCM155R71H472KA37D 
 		1x connected between pin 2 of R9 and analog GND (C10)
		1x connected between pin 2 of R10 and analog GND (C11)
		1x connected between pin 2 of R11 and analog GND (C12)

	3x 2.2 uf ceramic capacitors part number C3216X7R1H225K160AE 
		1x connected between pin 7 and pin 3 of CS1 (C13)
		1x connected between pin 7 and pin 3 of CS2 (C14)
		1x connected between pin 7 and pin 3 of CS3 (C15)

 Temperature sensing for MOSFETS

	1x NTC resistor part number NCP18XH103F03RB connected between 5V+ and pin 37 of DSC and placed next to one of the powerfets (RTS)
	1x 2.2 uf capacitor part number C1608X5R1C225M080AB connected between DSC pin 37 and analog GND (C16)
	1x 10 kohm resistor part number RK73H1JTTD1002F connected betweeen DSC pin 37 and analog GND (R15)


 Power supply decoupling (place as close to P7 as possible, can be on one or both sides)
	4x 330uf 50 volt aluminum electrolytic capacitors part number EEV-FK1J681M  
		4x in parallel with positive ends connected to the Battery Supply and negative, side with bar, ends connected to dig GND (C17),(C18),(C46),(C47)


 Motor driver:

	1x  premotor drivers part number  DRV8302. integrated buck converter output is five volts for each driver and each attached to a seperate 5 volt powerplane 
	(DRV1) pinout:
		pin 1: connected to pin 1 of R19
		pin 2: connected to pin 1 of C20 and pin 1 of R18
		pin 3: connected between pin 2 of R17 and pin 1 of R16
		pin 4: connected to digital GND (unused input)
		pin 5: not connected (unused output)
		pin 6: connected to pin 67 of DSC
		pin 7: connected to pin 1 of R21
		pin 8: connected to signal GND
		pin 9: connected to 3.3V 
		pin 10: connected to analog ground
		pin 11: connected to pin 23 of DVR1
		pin 12: connected to digital GND (unused input)
		pin 13: connected to pin 1 of C24
		pin 14: connected to pin 1 of C21
		pin 15: connected to pin 2 of C21
		pin 16: connected to pin 44 of DSC
		pin 17: connected to pin 39 of DSC
		pin 18: connected to pin 38 of DSC
		pin 19: connected to pin 41 of DSC
		pin 20: connected to pin 40 of DSC
		pin 21: connected to pin 43 of DSC
		pin 22: connected to pin 42 of DSC
 		pin 23: connected to pin 1 of C23 and pin 1 of C22
		pin 24: connected to 3.3V
		pin 25: not connected (unused output)
		pin 26: not connected (unused output)
		pin 27: connected to pin 1 of C25 
		pin 28: connected to analog GND
		pin 29: connected to pin of C33
		pin 30: connected to digital gnd
		pin 31: connected to digital gnd
		pin 32: connected to digital gnd
		pin 33: connected to digital gnd
		pin 34: S_L3 connected to pin 3 of Q6
		pin 35: G_L3 connected to pin 1 of R8
		pin 36: S_H3 connected to pin 3 of Q5 and pin 2 of C27
		pin 37: G_H3 connected to pin 1 of R7
		pin 38: connected to pin 1 of C26 
		pin 39: S_L2 connected to pin 3 of Q4
		pin 40: G_L2 connected to pin 1 of R6
		pin 41: S_H2 connected to pin 3 of Q3 and pin 2 of C28
		pin 42: G_H2 connected to pin 1 of R5
		pin 43: connected to pin 1 of C27
		pin 44: S_L1 connected to pin 3 of Q2
		pin 45: G_L1 connected to pin 1 of R4
		pin 46: S_H1 connected to pin 3 of Q1 and pin 2 of C29
		pin 47: G_H1 connected to pin 1 of R3 
		pin 48: connected to pin 1 of C28
		pin 49: connected to pin 1 of R20 
		pin 50: connected to pin 51 of DVR1
		pin 51: connected to cathode end of D1, pin 2 of C30 and pin 1 of L1 
		pin 52: connected to pin 1 of C30
		pin 53: connected to pin 54 of DVR1
		pin 54: connected to battery supply 
		pin 55: not connected (float means always enabled)
		pin 56: connected to pin 1 of C31
		pin 57: Is a pad on the bottom of the device that should be connected to digital GND 


	1x 3.3 kohm resistors part number RK73H1JTTD3301F
		1x connected between digital GND and pin 2 of R46 (R16)


	1x 18 kohm resistors  part number RK73H1JTTD1802F
		1x connected between 5 volt section #1 and pin 1 of R16 (R17)

	1x 15 kohm resistors part number RK73H1JTTD1502F
		1x connected between pin 2 of DVR1 and pin 1 of C19 (R18)


	1x 220 kohm resistors part number RK73H1JTTD2203F
		1x connected between pin 1 of DVR1 and digital GND (R19)
	
	1x 6.8 nf ceramic capacitors part number CGA3E2C0G1H682JD
		1x connected between pin 2 of R18 and digital GND (C19)

 	1x 120 pf ceramic capacitors part number C0603C121J5GACTU
		1x connected between pin 2 of DVR1 and digital GND (C20)

	1x 1000 kohm resistors part number RK73H1JTTD1004F
		1x connected between pin 49 of DVR1 and digital GND (R20)

	1x 10 kohm resistor part number RK73H1JTTD1002F 
		1x connected between pin 7 of DVR1 and digital GND (R21)

	1x 22 nf ceramic capacitors part number CGA3E2X7R1H223K080AA
		1x connected between pin 14 and pin 15 of DVR1 (C21)


	5x 2.2 uf ceramic capacitors part number C1608X5R1C225M080AB
		2x connected in parallel between digital GND and pin 23 of DVR1 (C22),(C23)		
		1x connected between pin 13 of DVR1 and digital GND (C24)
		1x connected between pin 27 and pin 28 of DVR1 (C25)
		1x connected in parallel with C34 with pin 1 also connected to pin 2 of L1 (C26)

	
	3x 220 nf ceramic capacitors part number CGA2B3X7R1E224K050BE
		1x connected between pin 38 and pin 36 of DVR1 (C27)
		1x connected between pin 43 and pin 41 of DVR1 (C28) 
		1x connected between pin 48 and pin 46 of DVR1 (C29)
		

	1x 100 nf ceramic capacitors part number AS0805KKX7R0BB104
		1x connected between pin 52 and 51 of DRV1 (C30)
	

	1x 15 nf ceramic capacitors part number C0603C153J3GACTU 
		1x connected between digital gnd and pin 56 of DVR1 (C31)
		
	1x 4.7 uf ceramic capacitors part number CGA6M3X7S2A475K200AB
		1x connected between pin 54 of DVR1 and digital GND, placed as close as possible (C32)
		1x connected between pin 29 of DVR1 and digital GND, placed as close as possible (C33)
 		
	1x 22 uh power inductors part number SDR0805-220ML 
		1x connected between pin 51 of DVR1 and 5V+  (L1)
	
	
	1x 60V 2A shtocky diode part number 771-PMEG6020ER-115 
		1x connected between pin 51 of DVR1 and digital GND (D1)
		

	1x 100 uf ceramic capacitors part number LMK325ABJ107MM-t
		1x connected between 5V+ and digital GND in parallel with C26 (C34)

	




	 



	
	










