/*
 * FOC.c
 *
 *  Created on: Sep 17, 2019
 *      Author: matthew
 */
#include "stm32f765xx.h"





void foc_init(void){
	TIM1->CR1|=0x20; //set to center aligned mode 1 (events only triggered on down counting)
	TIM1->CR2|=0x3F00;
	TIM1->ARR|=0x1518; //set period for 20khz-> 216mhz/20khz=10800/2=0x1518
	//configure channels 1,2,3 in PWM mode
	TIM1->CCMR1|=0x6868;
	TIM1->CCMR2|=0x68;
	TIM1->CCER|=0x444;
	//initalize duty cycle
	TIM1->CCR1|=TIM1->ARR/2;
	TIM1->CCR2|=TIM1->ARR/2;
	TIM1->CCR3|=TIM1->ARR/2;
	//Break, dead time, lock configuration
	TIM1->BDTR|=0x2C4E;
	TIM1->CR2|=0x1;//preload capture and control regs
	TIM1->CR1|=0x80;//enable Auto-reload preload
	TIM1->EGR|=0x1;//load all registers with their values

	//configure ADC



	//enable timer
	TIM1->CR1|=0x1;
}
